
## 模型结构解剖（层级图）

### Baseline: LightGCN 结构

![preview](lightgcn_taobao/docs/baseline_lightgcn.mermaid)

### 改进: LightGCN + SGL 结构

![preview](lightgcn_taobao/docs/lightgcn_sgl.mermaid)

### 我们到底用到了哪些“层”？

- **Embedding 层 (nn.Embedding)**
  - **职责**: 创建用户和物品的嵌入向量表，这是模型学习个体特征的基础。每个用户和物品都被映射到一个低维、密集的向量空间。

- **图传播层 (Graph Propagation)**
  - **职责**: 通过与归一化邻接矩阵 `A_norm` 进行稀疏矩阵乘法，实现邻居信息的聚合。这一过程是线性的，没有全连接层（FC）、非线性激活函数或权重变换矩阵，是 LightGCN “轻量化”的核心。

- **层间聚合 (Layer Aggregation)**
  - **职责**: 将初始嵌入和每一层传播后得到的嵌入进行聚合（通常是逐元素求和或取平均），形成最终的用户和物品表示。这保留了来自不同阶邻居的信息。

- **评分与损失函数 (Scoring & Loss)**
  - **职责**:
    - **评分**: 使用用户和物品的最终表示进行内积（点积），计算出预测的偏好分数。
    - **BPR 损失**: 通过比较用户对正样本（已交互物品）和负样本（未交互物品）的评分，优化模型参数，使得正样本的评分高于负样本。

- **SGL 分支 (Self-supervised Graph Learning)**
  - **职责**:
    - **视图增强**: 对原始图进行两次独立的、随机的扰动（如边丢弃、节点丢弃），创建两个略有不同的图视图。
    - **InfoNCE 对比损失**: 在两个视图中，最大化同一用户表示之间的一致性，同时最小化不同用户表示之间的一致性。这有助于模型学习对结构扰动更鲁棒的表示，缓解数据稀疏问题。
